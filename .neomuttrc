# Neomutt Multi-Account Configuration
# Gmail + Georgia Tech Office 365
# Generated by Claude Code

# ============================================================================
# Account Management
# ============================================================================

set use_from = yes
set ssl_force_tls = yes

# Account switching macros
# F2 = Gmail, F3 = GT
macro index,pager <f2> '<enter-command>source ~/.neomutt/account.gmail<enter><change-folder>!<enter>' "Switch to Gmail"
macro index,pager <f3> '<enter-command>source ~/.neomutt/account.gatech<enter><change-folder>!<enter>' "Switch to GT"

# Quick shortcuts
macro index,pager ,g '<enter-command>source ~/.neomutt/account.gmail<enter><change-folder>!<enter>' "Switch to Gmail"
macro index,pager ,t '<enter-command>source ~/.neomutt/account.gatech<enter><change-folder>!<enter>' "Switch to GT (Tech)"

# Default to Gmail on startup
source ~/.neomutt/account.gmail

# ============================================================================
# General Settings
# ============================================================================

# Cache for better performance
set header_cache = "~/.neomutt/cache/headers"
set message_cachedir = "~/.neomutt/cache/bodies"
set certificate_file = "~/.neomutt/certificates"

# Create cache directories if they don't exist
set tmpdir = "~/.neomutt/tmp"

# Performance
set mail_check = 120          # Check for new mail every 2 minutes
set timeout = 300              # Wait 5 minutes before checking again
set imap_keepalive = 300       # Keep IMAP connection alive
set imap_idle = yes            # Use IMAP IDLE for push notifications

# Composing
set editor = "nvim"
set edit_headers = yes         # Show headers when composing
set fast_reply = yes           # Skip prompts when replying
set include = yes              # Include message in reply
set forward_quote = yes        # Quote forwarded messages

# Reading
set pager_stop = yes           # Don't jump to next message
set menu_scroll = yes          # Scroll menu one line at a time
set tilde = yes                # Show tildes at end of message (vim-like)
set markers = no               # Don't show + for wrapped lines
set pager_index_lines = 10     # Show mini-index above message (vim split style)
set pager_context = 3          # Lines of context when scrolling

# Sorting
set sort = "threads"
set sort_aux = "reverse-last-date-received"
set strict_threads = yes
set collapse_unread = no       # Don't collapse threads with unread

# ============================================================================
# Keybindings
# ============================================================================

# Vim-like bindings
bind index,pager g noop
bind index,pager G noop
bind index gg first-entry
bind index G last-entry
bind pager gg top
bind pager G bottom
bind index,pager \Cu half-up
bind index,pager \Cd half-down
bind pager j next-line
bind pager k previous-line
bind index,pager h noop
bind index,pager l noop
bind index l display-message
bind pager h exit

# Vim-style searching
bind index,pager / search
bind index,pager ? search-reverse
bind index,pager n search-next
bind index,pager N search-opposite

# Navigation
bind index,pager R group-reply
bind index <space> collapse-thread
bind index za collapse-thread    # Like vim fold toggle
bind index zR collapse-all        # Open all threads
bind index zM collapse-all        # Close all threads (using same key)

# Window navigation (vim hjkl style)
# First unbind defaults that might conflict
bind index \Ch noop
bind pager \Ch noop
bind index \Cl noop
bind pager \Cl noop
bind index \Cj noop
bind pager \Cj noop
bind index \Ck noop
bind pager \Ck noop

# Now set our vim-style window navigation
bind pager \Ch exit                           # Ctrl-h = back to index
bind index \Ch sidebar-toggle-visible         # Ctrl-h = toggle sidebar
bind index \Cl display-message                # Ctrl-l = open message
bind pager \Cl sidebar-toggle-visible         # Ctrl-l = toggle sidebar
bind index,pager \Cj sidebar-next             # Ctrl-j = next mailbox
bind index,pager \Ck sidebar-prev             # Ctrl-k = prev mailbox
bind index,pager \Co sidebar-open             # Ctrl-o = open mailbox
bind index,pager B sidebar-toggle-visible     # B = toggle sidebar
bind pager i exit                             # i = back to index

# Vim-style quit commands
bind index q quit                             # q = quit (already default)
bind index Q quit                             # Q = quit without confirm
macro index ZZ "<sync-mailbox><quit>" "Save and quit (vim style)"
macro pager ZZ "<sync-mailbox><exit><quit>" "Save and quit (vim style)"
macro index ZQ "<quit>" "Quit without saving (vim style)"
macro pager ZQ "<exit><quit>" "Quit without saving (vim style)"

# Additional vim-like bindings
bind index H top-page
bind index M middle-page
bind index L bottom-page
bind index d noop              # Unbind d first
bind index dd delete-message
bind index u undelete-message
bind pager J next-entry
bind pager K previous-entry

# Quick actions
macro index,pager gi "<change-folder>=INBOX<enter>" "Go to Inbox"
macro index,pager gs "<change-folder>=[Gmail]/Sent Mail<enter>" "Go to Sent"
macro index,pager gd "<change-folder>=[Gmail]/Drafts<enter>" "Go to Drafts"
macro index,pager gt "<change-folder>=[Gmail]/Trash<enter>" "Go to Trash"
macro index,pager ga "<change-folder>=[Gmail]/All Mail<enter>" "Go to All Mail"

# Archive (remove from Inbox, keep in All Mail)
macro index,pager A "<save-message>=[Gmail]/All Mail<enter>" "Archive message"

# ============================================================================
# Sidebar
# ============================================================================

set sidebar_visible = yes
set sidebar_width = 32
set sidebar_format = "%D %* %?N?%N ?%S"
set sidebar_short_path = yes
set sidebar_folder_indent = yes
set sidebar_indent_string = "  "
set sidebar_divider_char = "â”‚"
set sidebar_new_mail_only = no

# ============================================================================
# Colors (Nord Theme - matches zshrc and nvim)
# ============================================================================

source ~/.neomutt/nord.neomuttrc

# ============================================================================
# HTML Email
# ============================================================================

# Prefer plain text, fall back to HTML
alternative_order text/plain text/enriched text/html

# View HTML emails in browser if needed
macro pager \cb <pipe-entry>'urlview'<enter> 'Follow links with urlview'

# ============================================================================
# Misc Settings
# ============================================================================

set date_format = "%m/%d %H:%M"
set index_format = "%4C %Z %?X?ðŸ“Ž&  ? %D %-20.20L %s %> %?M?ðŸ§µ%M& ?"
set pager_format = "â”€ %C/%m: %-20.20n  %s%*  %P â”€"
set status_format = "â”€ %f %m messages%?n? (%n new)?%?d? (%d to delete)?%?t? (%t tagged)? %> %P â”€"
set reply_regexp = "^(([Rr][Ee]?(\[[0-9]+\])?: *)?(\[[^]]+\] *)?)*"
set quote_regexp = "^( {0,4}[>|:#%]| {0,4}[a-z0-9]+[>|]+)+"
set send_charset = "utf-8:iso-8859-1:us-ascii"
set charset = "utf-8"
set ascii_chars = no           # Use unicode for thread tree

# Don't ask these questions
set confirmappend = no
set delete = yes
set quit = yes
set move = no  # Gmail does this server-side

# Contacts/Aliases
set alias_file = "~/.neomutt/aliases"
set sort_alias = alias
set reverse_alias = yes
source ~/.neomutt/aliases

# ============================================================================
# Notmuch Integration (Optional - for fast search)
# ============================================================================

# Uncomment to enable notmuch search
# set nm_default_url = "notmuch:///Users/adjalali3/Mail"
# virtual-mailboxes "Inbox" "notmuch://?query=folder:INBOX"
# virtual-mailboxes "Archive" "notmuch://?query=folder:archive"
